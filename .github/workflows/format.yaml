name: Format
on:
  pull_request:
  push:
jobs:
  format-code:
    name: Format the repository
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Install nix
        uses: cachix/install-nix-action@v18
        with:
          github_access_token: ${{ secrets.GITHUB_TOKEN }}
      - name: Run formatter
        run: nix run nixpkgs#alejandra -- .
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v4
        with:
          title: "[BOT] format nix files"
          commit-message: |
            chore: format nix files
            This PR was auto-generated by GH Actions
          body: |
            Formatted nix files with `nixpkgs#alejandra`
          author: Github <noreply@github.com>
          branch: actions-format
          branch-suffix: timestamp
          delete-branch: true
